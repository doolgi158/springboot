<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{template/client/layout/layout}">
<head>
    <!--<link href="/css/busan.css" rel="stylesheet" />-->
</head>
<th:block layout:fragment="content">
    <div><h1>부산도보여행정보 서비스</h1></div>

    <div id="item">
        <div id="item-template">
            <div>
                <a href="#" class="item-light"><img /></a>
                <div>
                    <h5 class="item-title"></h5>
                    <p><small class="item-type"></small></p>
                    <p class="item-sub"></p>
                    <a class="detailBtn">상세정보</a>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block layout:fragment="script">
    <script>
        const template = (UC_SEQ, MAIN_TITLE, CATE2_NM, TITLE, MAIN_IMG_THUMB, PLACE) => {
            const div = document.getElementById('item');

            const template = document.getElementById('item-template');
            const element = template.cloneNode(true);
            element.dataset.seq = UC_SEQ;
            element.removeAttribute('id');

            element.querySelector('a.item-light > img').src = MAIN_IMG_THUMB;
            element.querySelector('.item-title').textContent += MAIN_TITLE;
            element.querySelector('.item-type').textContent += CATE2_NM;
            element.querySelector('.item-sub').textContent += TITLE;

            div.appendChild(element);
        }

        const url = "/data/busanWalkingList";
        fetch(url)
        .then(response => response.json())
        .then(data => {
            data.getWalkingKr.item.forEach(function(item) {
                template(item.UC_SEQ, item.MAIN_TITLE, item.CATE2_NM, item.TITLE, item.MAIN_IMG_THUMB, item.PLACE);
            })
        })
        .catch(error => {
            alert("정삭적으로 데이터를 읽어오지 못하고 있습니다. 잠시후에 다시 시도해 주세요.");
            console.log(error);
        });

        // 버튼 클릭했을 때 상세 페이지로 이동
        document.addEventListener("click", function(e) {
            if(e.target.classList.contains("detailBtn")) {
                e.preventDefault();
                const item = e.target.closest("div.item");
                const seq = item.dataset.seq;
                console.log("seq: " + seq);
                locationProcess(`/data/busanWalkingDetailView/&{seq}`);
            }
        });
    </script>
</th:block>
</html>